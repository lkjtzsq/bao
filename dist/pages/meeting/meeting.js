"use strict";loader.define(function(){bui.ready(function(){function e(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,s=e.getDate(),c=t+"-"+n+"-"+s;bui.ajax({url:a+"api/meeting",type:"get",data:{date:c,token:i},needNative:!0}).then(function(e){var e=e.data.data,t="";$(e).each(function(e,n){var i="",a=(n.name,n.meeting_desc,n.pnumber,n.address,n.books);n.id;$(a).each(function(e,t){i+=1==t?'<span style="background:#f5dcca"></span>':"<span></span>"});n.thumbnail[0];t+='<div class="meeting-item" data-id="'+n.id+'"><div class="meeting-room"><div class="meeting-left"><h1 class="meeting-title">'+n.name+'</h1><p class="meeting-cr p1">'+n.devices+'</p><p class="meeting-cr p2">'+n.pnumber+'人</p><p class="meeting-cr p3">'+n.address+'</p></div><div class="meeting-right"><img src="'+n.thumbnail+'"></div></div><div class="meeting-progress"><div class="progress-bar">'+i+'</div><div class="progress-count"><span>07</span><span>08</span><span>09</span><span>10</span><span>11</span><span>12</span><span>13</span><span>14</span><span>15</span><span>16</span><span>17</span><span>18</span><span>19</span><span>20</span><span>21</span><span>22</span><span>23</span></div></div></div>'}),$(t).appendTo($(".meeting-contain"))})}function t(e){var t=new Date,n=t.getFullYear(),s=t.getMonth()+1,c=t.getDate(),o=n+"-"+s+"-"+c;$(".ts-group").find('input[type="checkbox"]').removeAttr("checked"),bui.ajax({url:a+"api/meeting",type:"get",data:{date:o,token:i}}).then(function(t){console.log(t);var n=t.data.data[e].books;console.log(n),$(n).each(function(e,t){1==t?($(".ts-group").eq(e).find('input[type="checkbox"]').attr("disabled","true"),$(".ts-group").eq(e).find("label").addClass("disabled"),$(".ts-group").eq(e).find(".ts-tag").html("已预订")):($(".ts-group").eq(e).find('input[type="checkbox"]').removeAttr("disabled"),$(".ts-group").eq(e).find("label").removeClass("disabled"),$(".ts-group").eq(e).find(".ts-tag").html(""))})})}var n=bui.storage(),i=n.get("token")[0],a="http://qxbyd.cyol.com/";$("#demo").mobiscroll().calendar({lang:"zh"});var s=(new Date).getFullYear(),c=(new Date).getMonth()+1,o=(new Date).getDate();$("#demo").val(s+"/"+c+"/"+o);var p=$(window).height();$(".time-content").height(.8*p-129-61-10-5),$(".green-back").click(function(){bui.back()}),$(".mine").click(function(){router.load({url:"pages/mine/mine.html",param:{}})}),$("body").on("click",".meeting-item",function(){$("#theme").val("");var e=$(this).index(),n=$(this).attr("data-id");$(".ts-head h1").html($(this).find(".meeting-title").html()),$(".ts-desc").html($(this).find(".p1").html()),$(".ts-count span").html($(this).find(".p2").html()),$(".time-chose-bg,.time-chose").show(),$(".time-chose").attr("data-id",n),t(e)}),$(".time-chose-bg").click(function(){$(this).hide(),$(".time-chose").hide()}),$("#demo").change(function(){$(".meeting-contain").html(""),e()}),$("body").on("click",".meeting-right img",function(e){$(".view-pic-bg").show(),$(".view-pic").css("display","flex"),$(".view-pic img").attr("src",$(this).attr("src")),e.stopPropagation()}),$("body").on("click",".view-pic",function(){$(this).hide(),$(".view-pic-bg").hide()}),$(".meeting-contain").height($(window).height()-123),e(),$(".ts-group input").change(function(){var e=$('.time-content input[type="checkbox"]').not("[disabled]"),t=$('.time-content input[type="checkbox"]:checked').length,n=$(".time-content input.on");console.log("--------------"),console.log(n);var i=$('.time-content input[type="checkbox"]:checked').eq(0).parents(".ts-group").index(),a=$('.time-content input[type="checkbox"]:checked').eq(t-1).parents(".ts-group").index(),s=$(".ts-group input:checked").length,c=Math.ceil(s/2);console.log("step:"+c),console.log(i,a),$(this).hasClass("on")?$(this).removeClass("on"):(s>0?$(".ts-btn").addClass("on"):$(".ts-btn").removeClass("on"),e.slice(i,a+1).prop("checked","checked").addClass("on"))}),$("body").on("click",".ts-btn.on",function(){var e=($(this).attr("data-id"),$('.time-content input[type="checkbox"]:checked').length),t=$('.time-content input[type="checkbox"]:checked').eq(0).parents(".ts-group").index()+1,n=$('.time-content input[type="checkbox"]:checked').eq(e-1).parents(".ts-group").index()+1,s=$("#theme").val();""!==s?bui.ajax({url:a+"api/meeting/meeting_book",data:{token:i,mid:$(".time-chose").attr("data-id"),date:$("#demo").val().replace(/\//g,"-"),start_p:t,end_p:n,theme:s}}).then(function(e){$(".time-chose-bg,.time-chose").hide(),alert("预定成功")},function(e){alert("预定失败，请稍后尝试！")}):alert("会议主题不能为空！")})})});