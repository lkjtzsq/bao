"use strict";loader.define(function(){bui.ready(function(){function e(){bui.ajax({url:apiUrl+"api/meeting",type:"get",data:{date:$("#demo").val().replace(/\//g,"-"),token:s},needNative:!0}).then(function(e){console.log(e);var e=e.data.data,n="",s="";$(e).each(function(e,t){var i="",a=(t.name,t.meeting_desc,t.pnumber,t.address,t.books),o=(t.id,t.region);$(a).each(function(e,t){i+=1==t?'<span style="background:#e2e2e2"></span>':"<span></span>"});t.thumbnail[0];"1"==o&&(n+='<div class="meeting-item" data-id="'+t.id+'"><div class="meeting-room"><div class="meeting-left"><h1 class="meeting-title">'+t.name+'</h1><p class="meeting-cr p1">'+t.devices+'</p><p class="meeting-cr p2">'+t.pnumber+'人</p><p class="meeting-cr p3">'+t.address+'</p></div><div class="meeting-right"><img src="'+t.thumbnail+'"></div></div><div class="meeting-progress"><div class="progress-bar">'+i+'</div><div class="progress-count"><span>07</span><span>08</span><span>09</span><span>10</span><span>11</span><span>12</span><span>13</span><span>14</span><span>15</span><span>16</span><span>17</span><span>18</span><span>19</span><span>20</span><span>21</span><span>22</span><span>23</span></div></div></div>'),"2"==o&&(s+='<div class="meeting-item" data-id="'+t.id+'"><div class="meeting-room"><div class="meeting-left"><h1 class="meeting-title">'+t.name+'</h1><p class="meeting-cr p1">'+t.devices+'</p><p class="meeting-cr p2">'+t.pnumber+'人</p><p class="meeting-cr p3">'+t.address+'</p></div><div class="meeting-right"><img src="'+t.thumbnail+'"></div></div><div class="meeting-progress"><div class="progress-bar">'+i+'</div><div class="progress-count"><span>07</span><span>08</span><span>09</span><span>10</span><span>11</span><span>12</span><span>13</span><span>14</span><span>15</span><span>16</span><span>17</span><span>18</span><span>19</span><span>20</span><span>21</span><span>22</span><span>23</span></div></div></div>')}),$(n).appendTo($(".mc1")),$(s).appendTo($(".mc2")),$(".meeting-item").each(function(e,n){t($(this).attr("data-id"))})})}function t(e){$(".ts-group").find('input[type="checkbox"]').removeAttr("checked"),bui.ajax({url:apiUrl+"api/meeting",type:"get",data:{date:$("#demo").val().replace(/\//g,"-"),token:s}}).then(function(t){$(t.data.data).each(function(t,n){n.id==e&&$(n.books).each(function(t,n){1==n?($(".ts-group").eq(t).find('input[type="checkbox"]').attr("disabled","true"),$(".ts-group").eq(t).find("label").addClass("disabled"),$(".ts-group").eq(t).find(".ts-tag").html("已预订")):($(".ts-group").eq(t).find('input[type="checkbox"]').removeAttr("disabled"),$(".ts-group").eq(t).find("label").removeClass("disabled"),$(".ts-group").eq(t).find(".ts-tag").html(""));var s=$(".ts-group").eq(t).find(".ts-time").html().split("-")[1],i=$("#demo").val()+" "+s;new Date(i).getTime()<(new Date).getTime()&&($(".ts-group").eq(t).find('input[type="checkbox"]').attr("disabled","true"),$(".ts-group").eq(t).find("label").addClass("disabled"),$(".ts-group").eq(t).find(".ts-tag").html("已过期"),$(".meeting-item[data-id="+e+"]").find(".progress-bar span").eq(t).css("background","#e2e2e2"))})})})}var n=bui.storage(),s=n.get("token")[0];router.getPageParams();$("#demo").mobiscroll().calendar({lang:"zh"});var i=(new Date).getFullYear(),a=(new Date).getMonth()+1,o=(new Date).getDate();$("#demo").val(i+"/"+a+"/"+o);var c=$(window).height();$(".time-content").height(.8*c-129-61-10-5-12),$(".green-back").click(function(){router.back({name:"main"})}),$(".mine").click(function(){router.load({url:"pages/mine/mine.html",param:{}})}),$("body").on("click",".meeting-item",function(e){$("#theme").val("");var n=($(this).index(),$(this).attr("data-id"));$(".ts-head h1").html($(this).find(".meeting-title").html()),$(".ts-desc").html($(this).find(".p1").html()),$(".ts-count span").html($(this).find(".p2").html()),$(".time-chose-bg,.time-chose").show(),$(".time-chose").attr("data-id",n),e=n,t(e)}),$(".time-chose-bg").click(function(){$(this).hide(),$(".time-chose").hide()}),$("#demo").change(function(){$(".meeting-contain").html(""),e()}),$("body").on("click",".meeting-right img",function(e){$(".view-pic-bg").show(),$(".view-pic").css("display","flex"),$(".view-pic img").attr("src",$(this).attr("src")),e.stopPropagation()}),$("body").on("click",".view-pic",function(){$(this).hide(),$(".view-pic-bg").hide()}),$(".meeting-contain").height($(window).height()-123-8-54),e(),$(".ts-group input").change(function(){var e=$(this),t=$('.time-content input[type="checkbox"]'),n=$('.time-content input[type="checkbox"]:checked').length,s=($(".time-content input.on"),$('.time-content input[type="checkbox"]:checked').eq(0).parents(".ts-group").index()),i=$('.time-content input[type="checkbox"]:checked').eq(n-1).parents(".ts-group").index(),a=$(".ts-group input:checked").length,o=Math.ceil(a/2);console.log(s,i),a>0?$(".ts-btn").addClass("on"):$(".ts-btn").removeClass("on"),$(this).hasClass("on")?(console.log("取消事件"),$(this).removeClass("on"),console.log("step:"+o),t.slice(s,i+1).each(function(n,c){console.log(n),console.log("---------------"),console.log(e.siblings(".ts-time").html()),console.log("---------------"),console.log($(c).siblings(".ts-time").html()),e.siblings(".ts-time").html()==$(c).siblings(".ts-time").html()&&(n<o?(console.log("取消上半区"),$(t).slice(s,i+1).slice(0,n).prop("checked",!1).removeClass("on")):(console.log("取消下半区"),console.log($(t).slice(s,i+1)),$(t).slice(s,i+1).slice(n,a+1).prop("checked",!1).removeClass("on")))})):(t.slice(s,i+1).not("[disabled]").prop("checked","checked").addClass("on"),t.slice(s,i+1).each(function(e,n){$(n).attr("disabled")&&$(t).prop("checked",!1).removeClass("on")}))});var p=null;$("#theme").blur(function(){var e=$(".time-content").scrollTop();$("body").scrollTop(e+1)}),$("body").off("click",".ts-btn.on").on("click",".ts-btn.on",function(){null!=p&&clearTimeout(p),p=setTimeout(function(){var t=($(this).attr("data-id"),$('.time-content input[type="checkbox"]:checked').length),n=$('.time-content input[type="checkbox"]:checked').eq(0).parents(".ts-group").index()+1,i=$('.time-content input[type="checkbox"]:checked').eq(t-1).parents(".ts-group").index()+1,a=$("#theme").val();""==a&&alert("会议主题不能为空！"),""!==a&&s&&bui.ajax({url:apiUrl+"api/meeting/meeting_book",data:{token:s,mid:$(".time-chose").attr("data-id"),date:$("#demo").val().replace(/\//g,"-"),start_p:n,end_p:i,theme:a}}).then(function(t){alert("预定成功"),$(".time-chose-bg,.time-chose").hide(),$(".meeting-contain").html(""),e()},function(e){alert("预定失败，请稍后尝试！")})},500)})})});