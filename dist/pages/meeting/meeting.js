"use strict";loader.define(function(){bui.ready(function(){function e(){bui.ajax({url:apiUrl+"api/meeting",type:"get",data:{date:$("#demo").val().replace(/\//g,"-"),token:s},needNative:!0}).then(function(e){console.log(e);var e=e.data.data,t="",a="";$(e).each(function(e,n){var s="",i=(n.name,n.meeting_desc,n.pnumber,n.address,n.books),c=(n.id,n.region);$(i).each(function(e,t){s+=1==t?'<span style="background:#e2e2e2"></span>':"<span></span>"});n.thumbnail[0];"1"==c&&(t+='<div class="meeting-item" data-id="'+n.id+'"><div class="meeting-room"><div class="meeting-left"><h1 class="meeting-title">'+n.name+'</h1><p class="meeting-cr p1">'+n.devices+'</p><p class="meeting-cr p2">'+n.pnumber+'人</p><p class="meeting-cr p3">'+n.address+'</p></div><div class="meeting-right"><img src="'+n.thumbnail+'"></div></div><div class="meeting-progress"><div class="progress-bar">'+s+'</div><div class="progress-count"><span>07</span><span>08</span><span>09</span><span>10</span><span>11</span><span>12</span><span>13</span><span>14</span><span>15</span><span>16</span><span>17</span><span>18</span><span>19</span><span>20</span><span>21</span><span>22</span><span>23</span></div></div></div>'),"2"==c&&(a+='<div class="meeting-item" data-id="'+n.id+'"><div class="meeting-room"><div class="meeting-left"><h1 class="meeting-title">'+n.name+'</h1><p class="meeting-cr p1">'+n.devices+'</p><p class="meeting-cr p2">'+n.pnumber+'人</p><p class="meeting-cr p3">'+n.address+'</p></div><div class="meeting-right"><img src="'+n.thumbnail+'"></div></div><div class="meeting-progress"><div class="progress-bar">'+s+'</div><div class="progress-count"><span>07</span><span>08</span><span>09</span><span>10</span><span>11</span><span>12</span><span>13</span><span>14</span><span>15</span><span>16</span><span>17</span><span>18</span><span>19</span><span>20</span><span>21</span><span>22</span><span>23</span></div></div></div>')}),$(t).appendTo($(".mc1")),$(a).appendTo($(".mc2")),n()})}function t(e){$(".ts-group").find('input[type="checkbox"]').removeAttr("checked"),bui.ajax({url:apiUrl+"api/meeting",type:"get",data:{date:$("#demo").val().replace(/\//g,"-"),token:s}}).then(function(t){var a=t.data.data[e].books;$(a).each(function(e,t){1==t?($(".ts-group").eq(e).find('input[type="checkbox"]').attr("disabled","true"),$(".ts-group").eq(e).find("label").addClass("disabled"),$(".ts-group").eq(e).find(".ts-tag").html("已预订")):($(".ts-group").eq(e).find('input[type="checkbox"]').removeAttr("disabled"),$(".ts-group").eq(e).find("label").removeClass("disabled"),$(".ts-group").eq(e).find(".ts-tag").html(""))}),n(e)})}function n(e){$(".ts-group").each(function(e,t){var n=$(this).find(".ts-time").html().split("-")[1],a=$("#demo").val()+" "+n;new Date(a).getTime()<(new Date).getTime()&&($(".ts-group").eq(e).find('input[type="checkbox"]').attr("disabled","true"),$(".ts-group").eq(e).find("label").addClass("disabled"),$(".ts-group").eq(e).find(".ts-tag").html("已过期"),$(".meeting-item").each(function(t,n){$(this).find(".progress-bar span").eq(e).css("background","#e2e2e2")}))})}var a=bui.storage(),s=a.get("token")[0];router.getPageParams();$("#demo").mobiscroll().calendar({lang:"zh"});var i=(new Date).getFullYear(),c=(new Date).getMonth()+1,p=(new Date).getDate();$("#demo").val(i+"/"+c+"/"+p);var o=$(window).height();$(".time-content").height(.8*o-129-61-10-5-12),$(".green-back").click(function(){router.back({name:"main"})}),$(".mine").click(function(){router.load({url:"pages/mine/mine.html",param:{}})}),$("body").on("click",".meeting-item",function(){$("#theme").val("");var e=$(this).index(),n=$(this).attr("data-id");$(".ts-head h1").html($(this).find(".meeting-title").html()),$(".ts-desc").html($(this).find(".p1").html()),$(".ts-count span").html($(this).find(".p2").html()),$(".time-chose-bg,.time-chose").show(),$(".time-chose").attr("data-id",n),t(e)}),$(".time-chose-bg").click(function(){$(this).hide(),$(".time-chose").hide()}),$("#demo").change(function(){$(".meeting-contain").html(""),e()}),$("body").on("click",".meeting-right img",function(e){$(".view-pic-bg").show(),$(".view-pic").css("display","flex"),$(".view-pic img").attr("src",$(this).attr("src")),e.stopPropagation()}),$("body").on("click",".view-pic",function(){$(this).hide(),$(".view-pic-bg").hide()}),$(".meeting-contain").height($(window).height()-123-8-54),e(),$(".ts-group input").change(function(){var e=$('.time-content input[type="checkbox"]'),t=$('.time-content input[type="checkbox"]:checked').length,n=($(".time-content input.on"),$('.time-content input[type="checkbox"]:checked').eq(0).parents(".ts-group").index()),a=$('.time-content input[type="checkbox"]:checked').eq(t-1).parents(".ts-group").index(),s=$(".ts-group input:checked").length;Math.ceil(s/2);console.log(n,a),s>0?$(".ts-btn").addClass("on"):$(".ts-btn").removeClass("on"),$(this).hasClass("on")?$(this).removeClass("on"):(e.slice(n,a+1).not("[disabled]").prop("checked","checked").addClass("on"),console.log($(e).slice(n,a+1)),$(e).slice(n,a+1).each(function(t,s){$(s).attr("disabled")&&(console.log("进来:"+t),$(e).slice(n,a+1).slice(0,t).prop("checked",!1).removeAttr("on"))}))});var d=null;$("body").off("click",".ts-btn.on").on("click",".ts-btn.on",function(){null!=d&&clearTimeout(d),d=setTimeout(function(){var t=($(this).attr("data-id"),$('.time-content input[type="checkbox"]:checked').length),n=$('.time-content input[type="checkbox"]:checked').eq(0).parents(".ts-group").index()+1,a=$('.time-content input[type="checkbox"]:checked').eq(t-1).parents(".ts-group").index()+1,i=$("#theme").val();""==i&&alert("会议主题不能为空！"),""!==i&&s&&bui.ajax({url:apiUrl+"api/meeting/meeting_book",data:{token:s,mid:$(".time-chose").attr("data-id"),date:$("#demo").val().replace(/\//g,"-"),start_p:n,end_p:a,theme:i}}).then(function(t){alert("预定成功"),$(".time-chose-bg,.time-chose").hide(),$(".meeting-contain").html(""),e()},function(e){alert("预定失败，请稍后尝试！")})},500)})})});